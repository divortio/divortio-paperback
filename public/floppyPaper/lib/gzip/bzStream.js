/**
 * @file bzStream.js
 * @overview
 * Emulates the bzip2 `bz_stream` structure, managing input pointers and output consumption.
 * It holds the internal Pako instance and a queue for the compressed data chunks.
 */
export class BzStream {
    constructor(props = {}) {
        // --- C-Equivalent Fields for Streaming Control ---

        /**
         * @public
         * @type {Uint8Array | null}
         * @description Pointer to the next byte available in the input buffer.
         * @default null
         * @see C_TYPE: char* next_in
         */
        this.next_in = null;

        /**
         * @public
         * @type {number}
         * @description The number of bytes available at `next_in` for the compressor to read.
         * @default 0
         * @see C_TYPE: unsigned int avail_in
         */
        this.avail_in = props.avail_in !== undefined ? props.avail_in : 0;

        /**
         * @public
         * @type {number}
         * @description The total number of uncompressed bytes consumed (simulated to match input size).
         * @default 0
         * @see C_TYPE: unsigned int total_in_lo32
         */
        this.total_in = props.total_in !== undefined ? props.total_in : 0;

        /**
         * @public
         * @type {Uint8Array | null}
         * @description Pointer to the buffer where compressed output data should be written (e.g., print.buf).
         * @default null
         * @see C_TYPE: char* next_out
         */
        this.next_out = null;

        /**
         * @public
         * @type {number}
         * @description The output buffer space currently available at `next_out`.
         * @default 0
         * @see C_TYPE: unsigned int avail_out
         */
        this.avail_out = props.avail_out !== undefined ? props.avail_out : 0;

        /**
         * @public
         * @type {number}
         * @description The total number of compressed bytes produced so far.
         * @default 0
         * @see C_TYPE: unsigned int total_out_lo32
         */
        this.total_out = props.total_out !== undefined ? props.total_out : 0;

        // --- Internal Pako Emulation State ---

        /**
         * @private
         * @type {import('pako').Deflate | null}
         * @description The active Pako Deflate/Gzip instance.
         * @default null
         * @see C_TYPE: void* state
         */
        this._pako = null;

        /**
         * @private
         * @type {Array<Uint8Array>}
         * @description Queue for chunks generated by the pako.onData callback.
         * @default []
         */
        this._outputQueue = [];
    }
}