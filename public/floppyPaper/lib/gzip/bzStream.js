import {Deflate} from '../../vendor/pako/dist/pako.esm.js'
/**
 * @file bzStream.js
 * @overview
 * Emulates the bzip2 `bz_stream` structure, managing input pointers and output consumption.
 * It holds the internal Pako instance and a queue for the compressed data chunks.
 */
export class BzStream {

    /**
     * @public
     * @type {Uint8Array}
     * @description Pointer to the next byte available in the input buffer.
     * @default null
     * @see C_TYPE: char* next_in
     */
    next_in;

    /**
     * @public
     * @type {number}
     * @description The number of bytes available at `next_in` for the compressor to read.
     * @default 0
     * @see C_TYPE: unsigned int avail_in
     */
    avail_in;


    /**
     * @public
     * @type {number}
     * @description The total number of uncompressed bytes consumed (simulated to match input size).
     * @default 0
     * @see C_TYPE: unsigned int total_in_lo32
     */
    total_in;

    /**
     * @public
     * @type {Uint8Array}
     * @description Pointer to the buffer where compressed output data should be written (e.g., print.buf).
     * @default null
     * @see C_TYPE: char* next_out
     */
    next_out;

    /**
     * @public
     * @type {number}
     * @description The output buffer space currently available at `next_out`.
     * @default 0
     * @see C_TYPE: unsigned int avail_out
     */
    avail_out;

    /**
     * @public
     * @type {number}
     * @description The total number of compressed bytes produced so far.
     * @default 0
     * @see C_TYPE: unsigned int total_out_lo32
     */
    total_out;


    /**
     * @public
     * @type {Deflate}
     * @description The active Pako Deflate/Gzip instance.
     * @default null
     * @see C_TYPE: void* state
     */
    _pako;

    /**
     * @public
     * @type {Array<Uint8Array>}
     * @description Queue for chunks generated by the pako.onData callback.
     * @default []
     */
    _outputQueue

    constructor(props = {}) {
        // --- C-Equivalent Fields for Streaming Control ---

        this.next_in = null;
        this.next_out = null;
        this.avail_in = props.avail_in !== undefined ? props.avail_in : 0;
        this.avail_out = props.avail_out !== undefined ? props.avail_out : 0;
        this.total_in = props.total_in !== undefined ? props.total_in : 0;
        this.total_out = props.total_out !== undefined ? props.total_out : 0;
        this._pako = null;
        this._outputQueue = [];
    }
}